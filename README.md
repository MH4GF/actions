edited from PR #993